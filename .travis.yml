dist: trusty
sudo: required
language: node_js
services:
- docker
git:
  depth: 5
notifications:
  email: false
branches:
  only:
  - master
  - stable
  - petong/travis-ci
  - "/^v\\d+\\.\\d+\\.\\d+(-\\d+)?$/"
node_js:
- '8'
jobs:
  include:
  - stage: test travis-ci
    if: branch = petong/travis-ci
    script:
    - npm run lint
    - istanbul cover -x "**/seeds/**" -x "**/migrations/**" --include-all-sources --root
      ./build ./node_modules/mocha/bin/_mocha test --report lcovonly && cat ./coverage/lcov.info
      | ./node_modules/coveralls/bin/coveralls.js && rm -rf ./coverage
    deploy:
      provider: script
      script: echo "I love travis yml"
      skip_cleanup: true
      on:
        all_branches: true
  - stage: deploy to dev
    if: branch = master
    script:
    - npm run lint
    - istanbul cover -x "**/seeds/**" -x "**/migrations/**" --include-all-sources --root
      ./build ./node_modules/mocha/bin/_mocha test --report lcovonly && cat ./coverage/lcov.info
      | ./node_modules/coveralls/bin/coveralls.js && rm -rf ./coverage
    deploy:
      provider: script
      script: docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"; npm run docker:release -- dev
      skip_cleanup: true
      on:
        all_branches: true
  - stage: deploy to stable
    if: branch = stable
    script:
    - npm run lint
    - istanbul cover -x "**/seeds/**" -x "**/migrations/**" --include-all-sources --root
      ./build ./node_modules/mocha/bin/_mocha test --report lcovonly && cat ./coverage/lcov.info
      | ./node_modules/coveralls/bin/coveralls.js && rm -rf ./coverage
    deploy:
      provider: script
      script: docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"; npm run docker:release -- stable
      skip_cleanup: true
      on:
        all_branches: true
env:
  global:
    - DOCKER_USERNAME=augurintegration
    - AWS_REGION=us-east-1
    - secure: "ZjfOXhs1nl3/GfY42IR3V9krbY6fNNbkM6XCPu4572/smLToiIm95Evf0ELzEJBGCUh35st8FEwaM248vNKilk2fpC0Zorqh6HegzFUdUURBq9xAd6x7kq2CNx7kchc7y16OPz8pB2rYTpoGx4TUsjnARn+O1qLUQ9jeA0lRxR76JVqIzUbjpStni7ljOFRYaKHgARkFGnQIkmyyt7Vn13CQkR9qzB1kboKln982Rc97hDoQQI2zwMdc24eEMgwsuAGDSLmkCtPzHiAxDla9khk45J5wKKp5Raa9/8E9qmS7kTBdgxZOjaGF6NvtXFKk5rPlWEMDbv/fdbntOs7fDAnqGk8fejqv/EMlT1O3WlT+2N/jq5C9SDVCeTetMqcSN/LD5RO+SQhcFpImWVGXz71tyHiTIHmpAxXXaH6wPXZ+G9ds1nHrTw9RRV9HWxzXRo8nhPQkSXh2RyE+x2/uTZJFcdRzI8rkYr0bUpnt9aOIJ44/7ss667lytzcuT7OQQ/RMiHuA3YocG+5rjRnJLq3XTksk3w8Hrd4ohGPyuZvAoGCn08OcN9KG+BVR+7YEo9OE3ytxdKwEki8MawD/PAles/70eFozMOefLRpQnYOE1Cnpbwu+wgMeZQejfCaflhLOwArfh/jyMW1ogf5G1mrSkyrkMqxCEcL3bUNxRlI="
    - secure: "sZH6OhaxuwYXEnfGoPf5ciJ0ZzY7W2qEIrWSuBZpONRkgJWG7YDE5jXNpzdPLAKTT90AjDFhyHks/l4IT1fnX69srB89EYaTDZ0hsLmqnv7poAKjvB0NZpxD2tjV08G2IjmdhQkFDdO5J3rhuLvkBziHt9/FwGa0EqrmOhbaHSx8FJs1hJ1Uwh2aBSV6hFXox/JeU3+w8A58rs5DII8sqDPeGND5H+1b0JR8uTxyXj36FDebZawY060luslwAz5UsotUOxgWTfr1pr+aMBCsS5UJeR3Iy14dCrlZ7U9hYo0gjH9y3G63DR0wAIypgxLBcvJfOoEwHnGxH50Sl6GmJxPX9SuzsWTI7WSwuFeNQ+t9VRcLmnkx399OQgUzbm9BzBKLqPHvJYlPMJcsWq0M35fv3+WIuH3QCrZv0TDWxeVi8PNT7Hs7t8NT+SEObGoH1ed504pQtQwW5XSYk1HQvFA1co5+QO80fvgIiIUGNh/Cqn9f8ZjRWbU1Xp2gkxoVJbojFz37smgcO59HQPetfJgEAZhd0pbOcQxBJ3OqK0ncmDPz6wqkdaPuTn6cbPoI/xjzxgJswWiDN6BYGBLyamTwJp8Nbxo75DmgsaosSMnNRwq2iJlrToSVvWmi+M7nCtPCkLlbgCghdX4XDu52SpX9SDCNtD+/4gkb5RsPH9M="
    - secure: "UWQ7muvGrAHFliPKjwRG3IVPTxStc2psFTftJ93xpC1/blCf1h2QV5AcTjnwMQWiXwoXl+GA5Ut/yU92iFqbu/ZYULgMXTY+69U0Bwfdzs7LUjPB1//gaJOEs1N4mSOv2ECKpX9GCKN4Sj6kZ3oqdi6NANFzuDbvU0LIpyP+aAZ7/HIxwdDWstOnBjc+f/yl1cooayDyiHvE3dWO6/RG8riwD5McTxl+8IV83ukVAI/6b9075dr9D2aXBEcXbb6YzOiDw+EkZWeC/6jrQK93/e0cuw/itq8rlJb0QOj1OXsbJHpqVb7ZZF9N3f9ddAU0vG47iVO5Ok99MOgsM/T2JfQm0/LUMNsi1iYGlDbY1C5EZsqPLfVv7GIo9QiI8Z5kT+1vkzP13r/ogmZIkNaeBYApRA61lZAt/sdqEJdfP2m5CJ6+T+fINUsE6numBFkHawDec/TvERrvbDYO4OYMuzN8D4zCiCovffyKJlW28RDa4mf1j2eAT8uNCG+4faIcapWzW4iZDFq/LFTeTD0m2yyZiiFl5oKKF9KGidAmH2PuTyu0mHKTGqzVQeAJgsUo/EmOntKwIUoX8A2ZkZRZdZni5qdWbIYTQ8ZFMKpKO2E0/6jmoY1ukFwYNLLz5dL7MX1mgphzXRKaIhnmt9TDdXTma+/G2G0Wj84U1jKnlxU="

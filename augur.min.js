/**
 * JavaScript bindings for the Augur API
 * @author Jack Peterson (jack@tinybike.net)
 */
var rpc={protocol:"http",host:"127.0.0.1",port:8545,async:!0},NODE_JS="undefined"!=typeof module;if(NODE_JS)var http=require("http"),httpsync=require("http-sync"),keccak_256=require("js-sha3").keccak_256,BigNumber=require("bignumber.js"),XMLHttpRequest=require("xhr2");Array.prototype.loop=function(e){var t=this,n=t.length,r=-1,a=0,s=!1,o=function(){a-=1,r+=1,r!==n&&e(t[r],f)},c=function(){if(!s){for(s=!0;a>0;)o();s=!1}},f=function(){a+=1,"undefined"==typeof setTimeout?c():setTimeout(o,1)};f()};var Augur=function(e,t){function n(e){var t="[augur.js] ";e&&(t+=e.constructor==Object||e.constructor==Array?JSON.stringify(e,null,2):e.toString(),console.log(t))}function r(e,t,n,r){t=t||64;for(var a=(e.length-2)/t,s=Array(a),o=n||2,c=0;a>c;++c)s[c]="0x"+e.slice(o,o+t),r&&(s[c]=new BigNumber(s[c])),o+=t;return s.slice(1)}function a(e){for(var t=[];e>0;)t.push(String.fromCharCode(e%256)),e=Math.floor(e/256);return t.reverse().join("")}function s(e){for(var t,n="",r=0,a=e.length;a>r;++r)t=e.charCodeAt(r).toString(16),1===t.length&&(t="0"+t),n+=t;return n}function o(e){for(var t,n=e.toString(),r="",a=0,s=0;s<n.length;s+=2)t=n.substr(s,2),(a>1||"00"!=t)&&(r+=String.fromCharCode(parseInt(t,16)),a++);return r}function c(e,t){var n=e;for(t||(n=s(n));n.length<64;)n="0"+n;return n}function f(e,t,n,r){if(r&&"[]"===r.slice(-2)){for(var o,i="",u=0,g=e.length;g>u;++u)o=f(e[u],t,n,r.slice(0,-1)),i+=o.normal_args;return{len_args:c(a(e.length)),normal_args:"",var_args:i}}var d=normal_args=var_args="";return e&&("string"===t&&(d=c(a(e.length)),var_args=s(e)),"int"===t&&(e.constructor===Number?normal_args=c(a(e%Math.pow(2,n))):e.constructor===String&&(normal_args="0x"===e.slice(0,2)?c(e.slice(2),!0):c(a(parseInt(e)%Math.pow(2,n)))))),{len_args:d,normal_args:normal_args,var_args:var_args}}function i(e,t){t=t||"";for(var n=e+"(",r=0,a=t.length;a>r;++r){switch(t[r]){case"s":n+="string";break;case"i":n+="int256";break;case"a":n+="int256[]";break;default:n+="weird"}r!=a-1&&(n+=",")}for(var s=keccak_256(n+")").slice(0,8);"0"===s.slice(0,1);)s=s.slice(1);return"0x"+s}function u(e,t){try{"array"===e?t=r(t):"int"===e?t=parseInt(t):"bignumber"===e?t=new BigNumber(t):"string"===e&&(t=o(t))}catch(a){n(a)}return t}function g(e,t,n,r){var e=JSON.parse(e);if(e.error)console.error("["+e.error.code+"]",e.error.message);else{if(e.result&&(e=t?u(t,e.result):e.result),!(n&&e&&r))return e.result&&r?r(e):e.result?e.result:e;r(e)}}function d(e){var t;return e&&e.params&&e.params[0]&&e.params[0].returns&&(t=e.params[0].returns,delete e.params[0].returns),t}function p(t,n,r){var a,s=null;a=d(t);var t=JSON.stringify(t);if(n=void 0!==n?n:e.async,NODE_JS){if(!n)return s=httpsync.request({protocol:rpc.protocol,host:rpc.host,path:"/",port:rpc.port,method:"POST"}),s.write(t),g(s.end().body.toString(),a,n,r);s=new XMLHttpRequest,s.onreadystatechange=function(){4==s.readyState&&g(s.responseText,a,n,r)},s.open("POST",m,!0),s.setRequestHeader("Content-type","application/json"),s.send(t)}else{if(s=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),!n)return s.open("POST",m,!1),s.setRequestHeader("Content-type","application/json"),s.send(t),g(s.responseText,a,n,r);s.onreadystatechange=function(){4==s.readyState&&g(s.responseText,a,n,r)},s.open("POST",m,!0),s.setRequestHeader("Content-type","application/json"),s.send(t)}}function b(t,n,r){return e.data={id:e.id++,jsonrpc:"2.0"},e.data.method="null"===r?t.toString():(r||"eth_")+t.toString(),e.data.params=n?n.constructor===Array?n:[n]:[],e.data}var m=rpc.protocol+"://"+rpc.host+":"+rpc.port.toString();return e.id=1,e.data={},e.async=e&&e.async||t,e.default_gas="0x2dc6c0",e.coinbase=p(b("coinbase"),!1),e.errors={"0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff":{code:-1,message:"bad input or parent doesn't exist"},"0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe":{code:-2,message:"too many events"},"0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe":{code:-3,message:"too many outcomes"},"0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc":{code:-4,message:"not enough money or market already exists"}},e.contracts={whitelist:"0x21dbe4a05a9174e96e6c6bc1e05a7096338cb0d6",events:"0xb71464588fc19165cbdd1e6e8150c40df544467b",expiringEvents:"0x61d90fd4c1c3502646153003ec4d5c177de0fb58",reporting:"0xd1f7f020f24abca582366ec80ce2fef6c3c22233",branches:"0x13dc5836cd5638d0b81a1ba8377a7852d41b5bbe",info:"0x910b359bb5b2c2857c1d3b7f207a08f3f25c4a8b",cash:"0xf1d413688a330839177173ce98c86529d0da6e5c",markets:"0x75ee234fe5ef1cd493c2af38a2ae7d0d0cba01f5",checkQuorum:"0x4eaa7a8b00107bbc11909e327e163b067fd3cfb9",createBranch:"0x5c955b31ac72c83ffd7562aed4e2100b2ba09a3b",buyAndSellShares:"0xfde83609d8bd5e4bfd6479af2b1cb28c85f0bce7",createEvent:"0xcae6d5912033d66650894e2ae8c2f7502eaba15c",p2pwagers:"0x45077327d89f04c8b892ae0872e5c31fc0447288",sendReputation:"0x049487d32b727be98a4c8b58c4eab6521791f288",transferShares:"0x78da82256f5775df22eee51096d27666772b592d",makeReports:"0x72f249c06299308e5b7aaaa4d155ed61a1f66671",createMarket:"0x386acc6b970aea7c6f9b87e7622d2ae7c18d377a",closeMarket:"0xf365b989d905a63157af2885c3d5bf03d68be3cb",dispatch:"0x9bb646e3137f1d43e4a31bf8a6377c299f26727d",statistics:"0x0cb1277671d162b2f5c81e9435744f63768398d0",interpolate:"0xeb51564b43068745ae80136fcefe3ca532617a87",center:"0xcff950797165df23550b6d79fa98e55d4c250fbe",score:"0x7e6a5373193e42e77133b44707e6dbce92adc6f4",adjust:"0xfd268b3d161e0af75e487950d44e23c91229eb7f",resolve:"0x82a0ce86301c4f1832f78a324c20dd981e21d57b",payout:"0x0a4184e2bc58669fb78a9bcee0cc1ab0da9d3ce3",redeem_interpolate:"0x6e87d29e2b80d1cfeff57f782dcb57cd2cc15d2d",redeem_center:"0x1f0571210c03efb7a616ed8a29d408a81cefe846",redeem_score:"0xcd2f28fe067ea3cdc3b55f1a1e62cb347118b04c",redeem_adjust:"0x562cc65e8d901f03bbeb6d83011bbd48ad1d377e",redeem_resolve:"0xa9b43b17ed17106f075960f9b9af38c330df9471",redeem_payout:"0xe995724195e58489f75c2e12247ce28bf50a5245"},e.clone=function(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},e.range=function(e,t){for(var n=[],r=e;t>=r;r++)n.push(r);return n},e.rpc=function(t,n,r){return p(b(t,n,"null"),e.async,r)},e.eth=function(t,n,r){return p(b(t,n),e.async,r)},e.net=function(t,n,r){return p(b(t,n,"net_"),e.async,r)},e.web3=function(t,n,r){return p(b(t,n,"web3_"),e.async,r)},e.db=function(t,n,r){return p(b(t,n,"db_"),e.async,r)},e.shh=function(t,n,r){return p(b(t,n,"shh_"),e.async,r)},e.sha3=e.hash=function(t,n){return t?((t.constructor===Array||t.constructor===Object)&&(t=JSON.stringify(t)),p(b("sha3",t.toString(),"web3_"),e.async,n)):void 0},e.gasPrice=function(t){return p(b("gasPrice"),e.async,function(e){var n=parseInt(e.result);return t?t(n):n})},e.blockNumber=function(t){return p(b("blockNumber"),e.async,function(e){var n=parseInt(e.result);return t?t(n):n})},e.getBalance=e.balance=function(t,r,a){return p(b("getBalance",[t||e.coinbase,r||"latest"]),e.async,a||function(t){var r=new BigNumber(t.result).dividedBy(new BigNumber(10).toPower(18));return e.async?void n(r):r.toNumber()})},e.getTransactionCount=e.txCount=function(t,n){return p(b("getTransactionCount",t||e.coinbase),e.async,n)},e.pay=function(t,n,r,a){return this.sendTx({from:t||e.coinbase,to:n,value:r},a)},e.getTransactionByHash=e.getTx=function(t,n){return p(b("getTransactionByHash",t),e.async,n)},e.peerCount=function(t){return e.async?p(b("peerCount",[],"net_"),e.async,t):parseInt(p(b("peerCount",[],"net_"),e.async,t))},e.call=function(t,n){return t.to=t.to||"",t.gas=t.gas?"0x"+t.gas.toString(16):e.default_gas,p(b("call",t),e.async,n)},e.sendTransaction=e.sendTx=function(t,n){return t.to=t.to||"",t.gas=t.gas?"0x"+t.gas.toString(16):e.default_gas,p(b("sendTransaction",t),e.async,n)},e.publish=function(t,n){return this.sendTx({from:e.coinbase,data:t},n)},e.abi_data=function(e){e.signature=e.signature||"";for(var t=i(e["function"],e.signature),n=[],r=0,a=e.signature.length;a>r;++r)n.push("s"==e.signature[r]?"string":"a"==e.signature[r]?"int256[]":"int256");e.params?e.params.constructor===String?("["===e.params.slice(0,1)&&"]"===e.params.slice(-1)&&(e.params=JSON.parse(e.params)),e.params.constructor===String&&(e.params=[e.params])):e.params.constructor===Number&&(e.params=[e.params]):e.params=[];var s,o,c,u="",g="",d="";if(n.length!=e.params.length)return console.error("wrong number of parameters");for(r=0,a=n.length;a>r;++r)"string"===n[r]?(s="string",o=""):"int256[]"===n[r]?(s="int",o=256,c="[]"):(s="int",o=256),res=f(e.params[r],s,o,c),u+=res.len_args,g+=res.normal_args,d+=res.var_args;return t+=u+g+d},e.run=e.execute=e.invoke=function(t,n){var r,a,s;if(t){var t=e.clone(t);if(data_abi=this.abi_data(t),data_abi)return r={from:t.from||e.coinbase,to:t.to,data:data_abi,returns:t.returns},a=t.send?this.sendTx:this.call,s=!0,a(r,n)}return s?void 0:"Error invoking "+t["function"]+"@"+t.to+"\nExpected transaction format:"+JSON.stringify({from:"<sender's address> (hexstring; optional, coinbase default)",to:"<contract address> (hexstring)","function":"<function name> (string)",signature:'<function signature, e.g. "iia"> (string)',params:"<parameters passed to the function> (optional)",returns:'<"array", "int", "BigNumber", or "string" (default)>',send:"<true to sendTransaction, false to call (default)>"})},e.getCode=e.read=function(t,n,r){return t?p(b("getCode",[t,n||"latest"]),e.async,r):void 0},e.tx={getCashBalance:{from:e.coinbase,to:e.contracts.cash,"function":"balance",signature:"i",params:e.coinbase,returns:"BigNumber"},getRepBalance:{from:e.coinbase,to:e.contracts.reporting,"function":"getRepBalance",signature:"ii",returns:"BigNumber"},getBranches:{from:e.coinbase,to:e.contracts.branches,"function":"getBranches",returns:"array"},getMarkets:{from:e.coinbase,to:e.contracts.branches,"function":"getMarkets",signature:"i",returns:"array"},getMarketInfo:{from:e.coinbase,to:e.contracts.markets,"function":"getMarketInfo",signature:"i",returns:"array"},getMarketEvents:{from:e.coinbase,to:e.contracts.markets,"function":"getMarketEvents",signature:"i",returns:"array"},getNumEvents:{from:e.coinbase,to:e.contracts.markets,"function":"getNumEvents",signature:"i",returns:"int"},getEventInfo:{from:e.coinbase,to:e.contracts.events,"function":"getEventInfo",signature:"i",returns:"array"},getBranchID:{from:e.coinbase,to:e.contracts.markets,"function":"getBranchID",signature:"i"},getNonce:{from:e.coinbase,to:e.contracts.buyAndSellShares,"function":"getNonce",signature:"i"},getCurrentParticipantNumber:{from:e.coinbase,to:e.contracts.markets,"function":"getCurrentParticipantNumber",signature:"i"},getParticipantSharesPurchased:{from:e.coinbase,to:e.contracts.markets,"function":"getParticipantSharesPurchased",signature:"iii",returns:"BigNumber"},getSharesPurchased:{from:e.coinbase,to:e.contracts.markets,"function":"getSharesPurchased",signature:"ii",returns:"BigNumber"},getEvents:{from:e.coinbase,to:e.contracts.expiringEvents,"function":"getEvents",signature:"ii",returns:"array"},getVotePeriod:{from:e.coinbase,to:e.contracts.branches,"function":"getVotePeriod",signature:"i",returns:"int"},getPeriodLength:{from:e.coinbase,to:e.contracts.branches,"function":"getPeriodLength",signature:"i",returns:"int"},getBranch:{from:e.coinbase,to:e.contracts.events,"function":"getBranch",signature:"i"},sendCash:{from:e.coinbase,to:e.contracts.cash,"function":"send",send:!0,signature:"ii"},cashFaucet:{from:e.coinbase,to:e.contracts.cash,"function":"faucet",send:!0},reputationFaucet:{from:e.coinbase,to:e.contracts.reporting,"function":"faucet",send:!0},getDescription:{from:e.coinbase,to:e.contracts.info,"function":"getDescription",signature:"i",returns:"string"},createEvent:{from:e.coinbase,to:e.contracts.createEvent,"function":"createEvent",signature:"isiiii",send:!0},createMarket:{from:e.coinbase,to:e.contracts.createMarket,"function":"createMarket",signature:"isiiia",send:!0},buyShares:{from:e.coinbase,to:e.contracts.buyAndSellShares,"function":"buyShares",signature:"iiiii",returns:"int",send:!0},sellShares:{from:e.coinbase,to:e.contracts.buyAndSellShares,"function":"sellShares",signature:"iiiii",returns:"int",send:!0},sendReputation:{from:e.coinbase,to:e.contracts.sendReputation,"function":"sendReputation",signature:"iii",send:!0}},e.getCashBalance=function(t,n){t&&(e.tx.getCashBalance.params=t),e.invoke(e.tx.getCashBalance,n)},e.getRepBalance=function(t,n,r){e.tx.getRepBalance.params=[t,n],e.invoke(e.tx.getRepBalance,r)},e.getBranches=function(t){e.invoke(e.tx.getBranches,t)},e.getMarkets=function(t,n){e.tx.getMarkets.params=t,e.invoke(e.tx.getMarkets,n)},e.getMarketInfo=function(t,n){e.tx.getMarketInfo.params=t,e.invoke(e.tx.getMarketInfo,function(r){if(r){var a={currentParticipant:parseInt(r[1]),alpha:r[2],cumulativeScale:r[3],numOutcomes:parseInt(r[4]),tradingPeriod:parseInt(r[5]),tradingFee:r[6]};e.getDescription(t,function(e){e&&(a.description=e),n(a)})}})},e.getMarketEvents=function(t,n){e.tx.getMarketEvents.params=t,e.invoke(e.tx.getMarketEvents,n)},e.getNumEvents=function(t,n){e.tx.getNumEvents.params=t,e.invoke(e.tx.getNumEvents,n)},e.getEventInfo=function(t,n){e.tx.getEventInfo.params=t,e.invoke(e.tx.getEventInfo,function(r){if(r){var a={branch:parseInt(r[0]),expirationDate:parseInt(r[1]),outcome:parseInt(r[2]),minValue:parseInt(r[3]),maxValue:parseInt(r[4]),numOutcomes:parseInt(r[5])};e.getDescription(t,function(e){e&&(a.description=e),n(a)})}})},e.getDescription=function(t,n){e.tx.getDescription.params=t,e.invoke(e.tx.getDescription,n)},e.getBranchID=function(t,n){e.tx.getBranchID.params=t,e.invoke(e.tx.getBranchID,n)},e.getNonce=function(t,n){e.tx.getNonce.params=t,e.invoke(e.tx.getNonce,n)},e.getCurrentParticipantNumber=function(t,n){e.tx.getCurrentParticipantNumber.params=t,e.invoke(e.tx.getCurrentParticipantNumber,n)},e.getParticipantSharesPurchased=function(t,n,r,a){e.tx.getParticipantSharesPurchased.params=[t,n,r],e.invoke(e.gtx.getParticipantSharesPurchased,a)},e.getSharesPurchased=function(t,n,r){e.tx.getSharesPurchased.params=[t,n],e.invoke(e.tx.getSharesPurchased,r)},e.getEvents=function(t,n,r){e.tx.getEvents.params=[t,n],e.invoke(e.tx.getEvents,r)},e.getVotePeriod=function(t,n){e.tx.getVotePeriod.params=t,e.invoke(e.tx.getVotePeriod,n)},e.getPeriodLength=function(t,n){e.tx.getPeriodLength.params=t,e.invoke(e.tx.getPeriodLength,n)},e.getBranch=function(t,n){e.tx.getBranch.params=t,e.invoke(e.tx.getBranch,n)},e.createEvent=function(t,n,r,a,s,o,c,f){e.tx.createEvent.params=[t,n,r,a,s,o],e.tx.createEvent.send=!1,e.invoke(e.tx.createEvent,function(t){if(t){var n={id:t};c&&c(n),e.tx.createEvent.send=!0,e.invoke(e.tx.createEvent,function(r){if(r){n.txhash=r;var a=function(){e.getTx(r,function(r){r&&(e.getDescription(t,function(e){n.description=e,f&&f(n)}),clearInterval(s))})},s=setInterval(a,6e3)}})}})},e.createMarket=function(t,n,r,a,s,o,c,f,i){e.tx.createMarket.params=[t,n,r,a,s,o],e.tx.createMarket.send=!1,e.invoke(e.tx.createMarket,function(t){if(t){var n={id:t};e.errors[t]?(n.error="error "+e.errors[t].code.toString()+": "+e.errors[t].message,i&&i(n)):(c&&c(n),e.tx.createMarket.send=!0,e.invoke(e.tx.createMarket,function(r){if(r){n.txhash=r;var a=function(){e.getTx(r,function(r){r&&(e.getDescription(t,function(e){n.description=e,f&&f(n)}),clearInterval(s))})},s=setInterval(a,6e3)}}))}})},e.buyShares=function(t,n,r,a,s,o){e.tx.buyShares.params=[t,n,r,a,s],e.invoke(e.tx.buyShares,o)},e.sellShares=function(t,n,r,a,s,o){e.tx.sellShares.params=[t,n,r,a,s],e.invoke(e.tx.sellShares,o)},e.sendCash=function(t,n,r){e.tx.sendCash.params=[t,n],e.invoke(e.tx.sendCash,r)},e.cashFaucet=function(t){e.invoke(e.tx.cashFaucet,t)},e.reputationFaucet=function(t){e.invoke(e.tx.reputationFaucet,t)},e.buyShares=function(t,n,r,a,s,o){e.tx.buyShares.params=[t,n,r,a,s],e.invoke(e.tx.buyShares,o)},e.sellShares=function(t,n,r,a,s,o){e.tx.sellShares.params=[t,n,r,a,s],e.invoke(e.tx.sellShares,o)},e.sendReputation=function(t,n,r,a){e.tx.sendReputation.params=[t,n,r],e.invoke(e.tx.sendReputation,a)},e}(Augur||{},rpc.async);delete rpc,NODE_JS&&(module.exports=Augur);